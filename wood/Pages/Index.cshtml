@page
@model IndexModel
@{
    ViewData["Title"] = "Мир слов - главная";
}

<section class="container mb-5 mt-4">
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body p-4">
                            <span class="badge bg-danger mb-3">Новинка</span>
                            <h3 class="h4 fw-bold mb-3">Новинки февраля</h3>
                            <p class="text-muted mb-4">Свежие поступления книг</p>
                            <a href="#new-books" class="text-decoration-none fw-bold">Смотреть все →</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100 hover-card">
                        <div class="card-body p-4">
                            <span class="badge bg-success mb-3">Скидки</span>
                            <h3 class="h4 fw-bold mb-3">Специальные предложения</h3>
                            <p class="text-muted mb-4">До 30% на избранные книги</p>
                            <a href="#discounted-books" class="text-decoration-none fw-bold">Выбрать книгу →</a>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card border-0 shadow-sm bg-light hover-card">
                        <div class="card-body p-4">
                            <span class="badge bg-warning mb-3">Бестселлеры</span>
                            <h3 class="h4 fw-bold mb-3">Самые популярные книги</h3>
                            <p class="text-muted mb-0">Книги, которые читают все</p>
                            <a href="#bestsellers" class="text-decoration-none fw-bold mt-3 d-block">Посмотреть →</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                <div class="card-body p-4 d-flex flex-column justify-content-between">
                    <div>
                        <h4 class="h5 fw-bold mb-3">Клуб читателей</h4>
                        <p class="mb-4">Получите дополнительную скидку 10% на все новинки</p>
                    </div>
                    <div class="my-3 text-center">
                        <i class="fas fa-book-reader" style="font-size: 5rem; opacity: 0.8;"></i>
                    </div>
                    <a href="#" class="btn btn-outline-light rounded-pill">Подписаться</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Новинки литературы -->
<section class="container mb-5" id="new-books">
    <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4">
        <h2 class="h3 fw-bold mb-0">НОВИНКИ ЛИТЕРАТУРЫ</h2>
        <a href="#" class="text-decoration-none">Все новинки →</a>
    </div>
    <div class="row g-4">
        @foreach (var book in Model.NewBooks)
        {
            <div class="col-lg-2 col-md-4 col-sm-6">
                <div class="card h-100 border-0 shadow-sm hover-card">
                    <div class="position-relative">
                        @if (book.IsNew)
                        {
                            <span class="position-absolute top-0 start-0 badge bg-danger m-2">Новинка</span>
                        }
                        <button class="btn btn-link position-absolute top-0 end-0 m-2 p-0 favorite-btn" 
                                onclick="toggleFavorite(@book.Id, this)" 
                                style="z-index: 10; background: white; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <i class="far fa-heart text-danger" style="font-size: 1.2rem;"></i>
                        </button>
                        <img src="@book.ImageUrl" class="card-img-top" alt="@book.Title" style="height: 300px; object-fit: cover;">
                    </div>
                    <div class="card-body p-3">
                        <h5 class="card-title h6 fw-bold mb-2 text-truncate" title="@book.Title">@book.Title</h5>
                        <p class="card-text small text-muted mb-3 text-truncate" title="@book.Author">@book.Author</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                @if (book.OldPrice.HasValue)
                                {
                                    <span class="text-muted text-decoration-line-through small">@book.OldPrice ₽</span>
                                    <br>
                                }
                                <span class="h6 fw-bold text-danger mb-0">@book.Price ₽</span>
                            </div>
                            @if (book.Discount > 0)
                            {
                                <span class="badge bg-success">-@book.Discount%</span>
                            }
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pb-3 px-3">
                        <button class="btn btn-outline-primary w-100 rounded-pill btn-sm" onclick="addToCart(@book.Id, '@book.Title', @book.Price)">
                            <i class="fas fa-shopping-cart me-1"></i>В корзину
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<!-- Бестселлеры -->
<section class="container mb-5" id="bestsellers">
    <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4">
        <h2 class="h3 fw-bold mb-0">БЕСТСЕЛЛЕРЫ</h2>
        <a href="#" class="text-decoration-none">Все бестселлеры →</a>
    </div>
    <div class="row g-4">
        @foreach (var book in Model.BestSellers)
        {
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm hover-card">
                    <div class="position-relative">
                        @if (book.IsBestseller)
                        {
                            <span class="position-absolute top-0 start-0 badge bg-warning text-dark m-2">Бестселлер</span>
                        }
                        <button class="btn btn-link position-absolute top-0 end-0 m-2 p-0 favorite-btn" 
                                onclick="toggleFavorite(@book.Id, this)" 
                                style="z-index: 10; background: white; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <i class="far fa-heart text-danger" style="font-size: 1.2rem;"></i>
                        </button>
                        <img src="@book.ImageUrl" class="card-img-top" alt="@book.Title" style="height: 350px; object-fit: cover;">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title h6 fw-bold mb-2">@book.Title</h5>
                        <p class="card-text small text-muted mb-3">@book.Author</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                @if (book.OldPrice.HasValue)
                                {
                                    <span class="text-muted text-decoration-line-through small">@book.OldPrice ₽</span>
                                    <br>
                                }
                                <span class="h5 fw-bold text-danger mb-0">@book.Price ₽</span>
                            </div>
                            @if (book.Discount > 0)
                            {
                                <span class="badge bg-success">-@book.Discount%</span>
                            }
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pb-3">
                        <button class="btn btn-outline-primary w-100 rounded-pill">
                            <i class="fas fa-shopping-cart me-2"></i>В корзину
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<!-- Скидки -->
<section class="container mb-5" id="discounted-books">
    <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4">
        <h2 class="h3 fw-bold mb-0">
            <i class="fas fa-tag text-success me-2"></i>СПЕЦИАЛЬНЫЕ ПРЕДЛОЖЕНИЯ
        </h2>
        <a href="#" class="text-decoration-none">Все скидки →</a>
    </div>
    <div class="row g-4">
        @foreach (var book in Model.DiscountedBooks)
        {
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm hover-card">
                    <div class="position-relative">
                        @if (book.Discount > 0)
                        {
                            <span class="position-absolute top-0 start-0 badge bg-success m-2" style="font-size: 1rem;">-@book.Discount%</span>
                        }
                        <button class="btn btn-link position-absolute top-0 end-0 m-2 p-0 favorite-btn" 
                                onclick="toggleFavorite(@book.Id, this)" 
                                style="z-index: 10; background: white; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <i class="far fa-heart text-danger" style="font-size: 1.2rem;"></i>
                        </button>
                        <img src="@book.ImageUrl" class="card-img-top" alt="@book.Title" style="height: 350px; object-fit: cover;">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title h6 fw-bold mb-2">@book.Title</h5>
                        <p class="card-text small text-muted mb-3">@book.Author</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                @if (book.OldPrice.HasValue)
                                {
                                    <span class="text-muted text-decoration-line-through small">@book.OldPrice ₽</span>
                                    <br>
                                }
                                <span class="h5 fw-bold text-danger mb-0">@book.Price ₽</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pb-3">
                        <button class="btn btn-outline-primary w-100 rounded-pill" onclick="addToCart(@book.Id, '@book.Title', @book.Price)">
                            <i class="fas fa-shopping-cart me-2"></i>В корзину
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<style>
    .hover-card {
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
    }
    
    .favorite-btn {
        transition: transform 0.2s;
    }
    
    .favorite-btn:hover {
        transform: scale(1.1);
    }
    
    .favorite-btn.active i {
        font-weight: 900;
    }
</style>

<script>

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    
    function addToCart(bookId, bookTitle, bookPrice) {
        const existingItem = cart.find(item => item.id === bookId);
        
        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({
                id: bookId,
                title: bookTitle,
                price: bookPrice,
                quantity: 1
            });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        

        showNotification(`"${bookTitle}" добавлена в корзину!`, 'success');
        updateCartCount();
    }
    
    function updateCartCount() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartBadge = document.querySelector('.cart-badge');
        if (cartBadge) {
            cartBadge.textContent = totalItems;
            if (totalItems > 0) {
                cartBadge.style.display = 'inline-block';
            }
        }
    }
    

    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let favoritesData = JSON.parse(localStorage.getItem('favoritesData')) || [];
    
    function toggleFavorite(bookId, button) {
        const icon = button.querySelector('i');
        const index = favorites.indexOf(bookId);

        const card = button.closest('.card');
        const title = card.querySelector('.card-title').textContent.trim();
        const author = card.querySelector('.card-text').textContent.trim();
        const priceElement = card.querySelector('.h5.fw-bold.text-danger, .h6.fw-bold.text-danger');
        const priceText = priceElement ? priceElement.textContent.trim() : '0';
        const price = parseInt(priceText.replace(/\D/g, '')) || 0;
        const imageUrl = card.querySelector('img').src;
        
        if (index > -1) {
            favorites.splice(index, 1);
            favoritesData = favoritesData.filter(book => book.id !== bookId);
            icon.classList.remove('fas');
            icon.classList.add('far');
            button.classList.remove('active');
            showNotification('Удалено из избранного', 'info');
        } else {
            favorites.push(bookId);
            favoritesData.push({
                id: bookId,
                title: title,
                author: author,
                price: price,
                imageUrl: imageUrl
            });
            icon.classList.remove('far');
            icon.classList.add('fas');
            button.classList.add('active');
            showNotification('Добавлено в избранное!', 'success');
        }
        
        localStorage.setItem('favorites', JSON.stringify(favorites));
        localStorage.setItem('favoritesData', JSON.stringify(favoritesData));
        
        window.favorites = favorites;
        window.favoritesData = favoritesData;

        if (typeof updateFavoritesCount === 'function') {
            updateFavoritesCount();
        }
    }
    
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} position-fixed top-0 start-50 translate-middle-x mt-3`;
        notification.style.zIndex = '9999';
        notification.style.minWidth = '300px';
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
        
        document.querySelectorAll('.favorite-btn').forEach(button => {
            const bookId = parseInt(button.getAttribute('onclick').match(/\d+/)[0]);
            if (favorites.includes(bookId)) {
                const icon = button.querySelector('i');
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.classList.add('active');
            }
        });
    });
</script>
