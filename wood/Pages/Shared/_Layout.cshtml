<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>@ViewData["Title"] - Мир слов</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true"/>
    <link rel="stylesheet" href="~/wood.styles.css" asp-append-version="true"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm py-2">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" asp-area="" asp-page="/Index">
                <i class="fas fa-book-open me-2"></i>Мир слов
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" 
                    aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarMain">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link px-3 fw-medium "  asp-area="" asp-page="/Index">
                            Главная
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fw-medium" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Каталог
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Жанр</a></li>
                            <li><a class="dropdown-item" href="#">Новинки</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Хочешь узнать о нас?</a></li>
                        </ul>
                    </li>
        
                </ul>
                
                <div class="mx-auto w-50 d-none d-lg-block">
                    <form class="d-flex" asp-page="/Search" method="get">
                        <div class="input-group">
                            <input class="form-control border-end-0 rounded-start-pill" type="search" 
                                   name="query" placeholder="Найти книгу для души..." aria-label="Поиск">
                            <button class="btn btn-outline-primary rounded-end-pill" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="d-lg-none my-3">
                    <form class="d-flex" asp-page="/Search" method="get">
                        <div class="input-group">
                            <input class="form-control" type="search" name="query" 
                                   placeholder="Найти книгу для души..." aria-label="Поиск">
                            <button class="btn btn-primary" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>


                <div class="d-flex align-items-center">
                    <!-- Избранное с выпадающим списком -->
                    <div class="dropdown me-3">
                        <a href="#" class="nav-link position-relative" id="favoritesDropdown" 
                           data-bs-toggle="dropdown" aria-expanded="false" title="Избранное">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart">
                                <path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"/>
                            </svg>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger favorites-badge" style="display: none;">0</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="favoritesDropdown" style="min-width: 350px; max-height: 400px; overflow-y: auto;">
                            <h6 class="dropdown-header">Избранное</h6>
                            <div id="favoritesList">
                                <p class="text-muted text-center py-3">Список избранного пуст</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Корзина -->
                    <a href="/Cart" class="nav-link position-relative me-3" title="Корзина">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-basket">
                            <path d="m15 11-1 9"/><path d="m19 11-4-7"/><path d="M2 11h20"/><path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8a2 2 0 0 0 2-1.6l1.7-7.4"/><path d="M4.5 15.5h15"/><path d="m5 11 4-7"/><path d="m9 11 1 9"/>
                        </svg>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary cart-badge" style="display: none;">0</span>
                    </a>
                    <partial name="_LoginPartial"/>
                </div>
            </div>
        </div>
    </nav>
</header>

<div class="container mt-4">
    <main role="main" class="pb-3">
        @RenderBody()
    </main>
</div>
<footer class="footer border-top bg-light py-3 mt-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-4 text-center text-md-start mb-2 mb-md-0">
                <h5 class="text-primary mb-0"><i class="fas fa-book-open me-2"></i>Мир слов</h5>
            </div>
            
            <div class="col-md-4 text-center mb-2 mb-md-0">
                <ul class="list-inline mb-0">
                    <li class="list-inline-item mx-2"><a asp-area="" asp-page="/Index" class="text-decoration-none text-muted">Главная</a></li>
                    <li class="list-inline-item mx-2"><a asp-area="" asp-page="/Catalog" class="text-decoration-none text-muted">Каталог</a></li>
                    <li class="list-inline-item mx-2"><a asp-area="" asp-page="/About" class="text-decoration-none text-muted">О нас</a></li>
                    <li class="list-inline-item mx-2"><a asp-area="" asp-page="/Privacy" class="text-decoration-none text-muted">Конфиденциальность</a></li>
                </ul>
            </div>
            
            <div class="col-md-4">
                <div class="d-flex justify-content-center justify-content-md-end align-items-center">
                    <div class="d-flex gap-3 me-3">
                        <a href="#" class="text-dark"><i class="fab fa-telegram fa-lg"></i></a>
                        <a href="#" class="text-dark"><i class="fab fa-vk fa-lg"></i></a>
                        <a href="#" class="text-dark"><i class="fab fa-youtube fa-lg"></i></a>
                    </div>
                    <span class="text-muted small">&copy; 2026</span>
                </div>
            </div>
        </div>
    </div>
</footer>
<style>
   .animate-icon{
       
   }
    
</style>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>

<script>

    window.cart = JSON.parse(localStorage.getItem('cart')) || [];
    window.favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    window.favoritesData = JSON.parse(localStorage.getItem('favoritesData')) || [];
    
    function updateCartCount() {
        const totalItems = window.cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartBadge = document.querySelector('.cart-badge');
        if (cartBadge) {
            cartBadge.textContent = totalItems;
            cartBadge.style.display = totalItems > 0 ? 'inline-block' : 'none';
        }
    }
    
    function updateFavoritesCount() {
        const favoritesBadge = document.querySelector('.favorites-badge');
        if (favoritesBadge) {
            favoritesBadge.textContent = window.favorites.length;
            favoritesBadge.style.display = window.favorites.length > 0 ? 'inline-block' : 'none';
        }
        updateFavoritesList();
    }
    
    function updateFavoritesList() {
        const favoritesList = document.getElementById('favoritesList');
        if (!favoritesList) return;
        
        if (window.favoritesData.length === 0) {
            favoritesList.innerHTML = '<p class="text-muted text-center py-3">Список избранного пуст</p>';
            return;
        }
        
        let html = '';
        window.favoritesData.forEach(book => {
            const price = book.price || 0;
            html += `
                <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                    <img src="${book.imageUrl}" alt="${book.title}" style="width: 60px; height: 80px; object-fit: cover;" class="rounded me-3">
                    <div class="flex-grow-1">
                        <h6 class="mb-1 small">${book.title}</h6>
                        <p class="mb-1 text-muted small">${book.author}</p>
                        <span class="text-danger fw-bold">${price} ₽</span>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="removeFromFavorites(${book.id})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        });
        favoritesList.innerHTML = html;
    }
    
    function removeFromFavorites(bookId) {
        window.favorites = window.favorites.filter(id => id !== bookId);
        window.favoritesData = window.favoritesData.filter(book => book.id !== bookId);
        localStorage.setItem('favorites', JSON.stringify(window.favorites));
        localStorage.setItem('favoritesData', JSON.stringify(window.favoritesData));
        updateFavoritesCount();
        
        const buttons = document.querySelectorAll('.favorite-btn');
        buttons.forEach(button => {
            const btnBookId = parseInt(button.getAttribute('onclick').match(/\d+/)[0]);
            if (btnBookId === bookId) {
                const icon = button.querySelector('i');
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.classList.remove('active');
            }
        });
    }
    
   
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
        updateFavoritesCount();
    });
</script>

@await RenderSectionAsync("Scripts", required: false)
</body>
</html>